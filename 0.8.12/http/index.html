

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using rasa NLU as a HTTP server &mdash; rasa NLU 0.8.12 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/banner.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex/"/>
        <link rel="search" title="Search" href="../search/"/>
    <link rel="top" title="rasa NLU 0.8.12 documentation" href="../"/>
        <link rel="next" title="Using rasa NLU from python" href="../python/"/>
        <link rel="prev" title="Training Data Format" href="../dataformat/"/>
<link href="../_static/css/rasa_theme.css" rel="stylesheet" type="text/css">


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../" class="icon icon-home"> rasa NLU
          

          
          </a>

          
            
            
              <div class="version">
                0.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/">Tutorial: A simple restaurant search bot</a></li>
</ul>
<p class="caption"><span class="caption-text">User Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../config/">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migrating/">Migrating an existing app</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataformat/">Training Data Format</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using rasa NLU as a HTTP server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#running-the-server">Running the server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#emulation">Emulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#endpoints">Endpoints</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#post-parse-no-emulation"><code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/parse</span></code> (no emulation)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#post-train"><code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/train</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-status"><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/status</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#authorization">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#serving-multiple-apps">Serving Multiple Apps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../python/">Using rasa NLU from python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../entities/">Entity Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../closeloop/">Improving your models from feedback</a></li>
<li class="toctree-l1"><a class="reference internal" href="../persist/">Model Persistence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../languages/">Language Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipeline/">Processing Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migrations/">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license/">License</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/">Change Log</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">rasa NLU</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../">Docs</a> &raquo;</li>
        
      <li>Using rasa NLU as a HTTP server</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/http.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  


    
    



    <p class="scv-banner scv-sphinx_rtd_theme"><a href="../../0.15.1/http/"><b>Warning:</b> This document is for an old version of rasa NLU. The latest version is 0.15.1.</a></p>
<div class="section" id="using-rasa-nlu-as-a-http-server">
<span id="section-http"></span><h1>Using rasa NLU as a HTTP server<a class="headerlink" href="#using-rasa-nlu-as-a-http-server" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Before you can use the server, you need to train a model! See <a class="reference internal" href="../tutorial/#training-your-model"><span class="std std-ref">Training Your Model</span></a></p>
</div>
<p>The HTTP api exists to make it easy for non-python projects to use rasa NLU, and to make it trivial for projects currently using {wit,LUIS,api}.ai to try it out.</p>
<div class="section" id="running-the-server">
<h2>Running the server<a class="headerlink" href="#running-the-server" title="Permalink to this headline">¶</a></h2>
<p>You can run a simple http server that handles requests using your models with (single threaded)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python -m rasa_nlu.server -c config_spacy.json --server_model_dirs<span class="o">=</span>./model_YYYYMMDD-HHMMSS
</pre></div>
</div>
<p>If your server needs to handle more than one request at a time, you can use any WSGI server to run the rasa NLU server. Using gunicorn this looks like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ gunicorn -w <span class="m">4</span> --threads <span class="m">12</span> -k gevent -b <span class="m">127</span>.0.0.1:5000 rasa_nlu.wsgi
</pre></div>
</div>
<p>This will start a server with four processes and 12 threads. Since there is no standard way to pass command line arguments to the server, all your configuration
options need to be placed in your configuration file (including the <code class="docutils literal notranslate"><span class="pre">server_model_dirs</span></code>!). You can set the location of the configuration file using environment
variables, otherwise the default configuration from <code class="docutils literal notranslate"><span class="pre">config.json</span></code> will be loaded.</p>
</div>
<div class="section" id="emulation">
<h2>Emulation<a class="headerlink" href="#emulation" title="Permalink to this headline">¶</a></h2>
<p>rasa NLU can ‘emulate’ any of these three services by making the <code class="docutils literal notranslate"><span class="pre">/parse</span></code> endpoint compatible with your existing code.
To activate this, either add <code class="docutils literal notranslate"><span class="pre">'emulate'</span> <span class="pre">:</span> <span class="pre">'luis'</span></code> to your config file or run the server with <code class="docutils literal notranslate"><span class="pre">-e</span> <span class="pre">luis</span></code>.
For example, if you would normally send your text to be parsed to LUIS, you would make a <code class="docutils literal notranslate"><span class="pre">GET</span></code> request to</p>
<p><code class="docutils literal notranslate"><span class="pre">https://api.projectoxford.ai/luis/v2.0/apps/&lt;app-id&gt;?q=hello%20there</span></code></p>
<p>in luis emulation mode you can call rasa by just sending this request to</p>
<p><code class="docutils literal notranslate"><span class="pre">http://localhost:5000/parse?q=hello%20there</span></code></p>
<p>any extra query params are ignored by rasa, so you can safely send them along.</p>
</div>
<div class="section" id="endpoints">
<h2>Endpoints<a class="headerlink" href="#endpoints" title="Permalink to this headline">¶</a></h2>
<div class="section" id="post-parse-no-emulation">
<h3><code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/parse</span></code> (no emulation)<a class="headerlink" href="#post-parse-no-emulation" title="Permalink to this headline">¶</a></h3>
<p>You must POST data in this format <code class="docutils literal notranslate"><span class="pre">'{&quot;q&quot;:&quot;&lt;your</span> <span class="pre">text</span> <span class="pre">to</span> <span class="pre">parse&gt;&quot;}'</span></code>, you can do this with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl -XPOST localhost:5000/parse -d <span class="s1">&#39;{&quot;q&quot;:&quot;hello there&quot;}&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="post-train">
<h3><code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/train</span></code><a class="headerlink" href="#post-train" title="Permalink to this headline">¶</a></h3>
<p>You can post your training data to this endpoint to train a new model.
this starts a separate process which you can monitor with the <code class="docutils literal notranslate"><span class="pre">/status</span></code> endpoint. If you want to name your model
to be able to use it during parse requests later on, you should pass the name <code class="docutils literal notranslate"><span class="pre">/train?name=my_model</span></code>. Any parameter
passed with the query string will be treated as a configuration parameter of the model, hence you can change all
the configuration values listed in the configuration section by passing in their name and the adjusted value.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl -XPOST localhost:5000/train -d @data/examples/rasa/demo-rasa.json
</pre></div>
</div>
</div>
<div class="section" id="get-status">
<h3><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/status</span></code><a class="headerlink" href="#get-status" title="Permalink to this headline">¶</a></h3>
<p>This checks if there is currently a training process running (you can only run one at a time).
also returns a list of available models the server can use to fulfill <code class="docutils literal notranslate"><span class="pre">/parse</span></code> requests.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl localhost:5000/status <span class="p">|</span> python -mjson.tool
<span class="o">{</span>
  <span class="s2">&quot;training&quot;</span> : False
  <span class="s2">&quot;models&quot;</span> : <span class="o">[]</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="authorization">
<span id="section-auth"></span><h2>Authorization<a class="headerlink" href="#authorization" title="Permalink to this headline">¶</a></h2>
<p>To protect your server, you can specify a token in your rasa NLU configuration, e.g. by adding <code class="docutils literal notranslate"><span class="pre">&quot;token&quot;</span> <span class="pre">:</span> <span class="pre">&quot;12345&quot;</span></code> to your config file, or by setting the <code class="docutils literal notranslate"><span class="pre">RASA_TOKEN</span></code> environment variable.
If set, this token must be passed as a query parameter in all requests, e.g. :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl localhost:5000/status?token<span class="o">=</span><span class="m">12345</span>
</pre></div>
</div>
</div>
<div class="section" id="serving-multiple-apps">
<span id="section-http-config"></span><h2>Serving Multiple Apps<a class="headerlink" href="#serving-multiple-apps" title="Permalink to this headline">¶</a></h2>
<p>Depending on your choice of backend, rasa NLU can use quite a lot of memory.
So if you are serving multiple models in production, you want to serve these
from the same process &amp; avoid duplicating the memory load.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Although this saves the backend from loading the same backend twice, it still needs to load one set of
word vectors (which make up most of the memory consumption) per language and backend.</p>
</div>
<p>You can use the multi-tenancy mode by replacing the <code class="docutils literal notranslate"><span class="pre">server_model_dirs</span></code> config
variable with a json object describing the different models.</p>
<p>For example, if you have a restaurant bot and a hotel bot, your configuration might look like this:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;server_model_dirs&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;hotels&quot;</span> <span class="p">:</span> <span class="s2">&quot;./model_XXXXXXX&quot;</span><span class="p">,</span>
    <span class="nt">&quot;restaurants&quot;</span> <span class="p">:</span> <span class="s2">&quot;./model_YYYYYYY&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You then pass an extra <code class="docutils literal notranslate"><span class="pre">model</span></code> parameter in your calls to <code class="docutils literal notranslate"><span class="pre">/parse</span></code> to specify which one to use:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> curl <span class="s1">&#39;localhost:5000/parse?q=hello&amp;model=hotels&#39;</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> curl -XPOST localhost:5000/parse -d <span class="s1">&#39;{&quot;q&quot;:&quot;I am looking for Chinese food&quot;, &quot;model&quot;: &quot;restaurants&quot;}&#39;</span>
</pre></div>
</div>
<p>If one of the models is named <code class="docutils literal notranslate"><span class="pre">default</span></code>, it will be used to serve requests missing a <code class="docutils literal notranslate"><span class="pre">model</span></code> parameter.
If no model is named <code class="docutils literal notranslate"><span class="pre">default</span></code> requests without a model parameter will be rejected.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../python/" class="btn btn-neutral float-right" title="Using rasa NLU from python" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../dataformat/" class="btn btn-neutral" title="Training Data Format" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Lastmile Technologies Ltd.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: 0.8.12
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="../../0.15.1/http/">0.15.1</a></dd>
            <dd><a href="../../0.15.0/http/">0.15.0</a></dd>
            <dd><a href="../../0.14.6/http/">0.14.6</a></dd>
            <dd><a href="../../0.14.5/http/">0.14.5</a></dd>
            <dd><a href="../../0.14.4/http/">0.14.4</a></dd>
            <dd><a href="../../0.14.3/http/">0.14.3</a></dd>
            <dd><a href="../../0.14.2/http/">0.14.2</a></dd>
            <dd><a href="../../0.14.1/http/">0.14.1</a></dd>
            <dd><a href="../../0.14.0/http/">0.14.0</a></dd>
            <dd><a href="../../0.13.8/http/">0.13.8</a></dd>
            <dd><a href="../../0.13.7/http/">0.13.7</a></dd>
            <dd><a href="../../0.13.6/http/">0.13.6</a></dd>
            <dd><a href="../../0.13.5/http/">0.13.5</a></dd>
            <dd><a href="../../0.13.4/http/">0.13.4</a></dd>
            <dd><a href="../../0.13.3/http/">0.13.3</a></dd>
            <dd><a href="../../0.13.2/http/">0.13.2</a></dd>
            <dd><a href="../../0.13.1/http/">0.13.1</a></dd>
            <dd><a href="../../0.13.0/http/">0.13.0</a></dd>
            <dd><a href="../../0.12.4/index/">0.12.4</a></dd>
            <dd><a href="../../0.12.3/http/">0.12.3</a></dd>
            <dd><a href="../../0.12.2/http/">0.12.2</a></dd>
            <dd><a href="../../0.12.1/http/">0.12.1</a></dd>
            <dd><a href="../../0.12.0/http/">0.12.0</a></dd>
            <dd><a href="../../0.11.4/http/">0.11.4</a></dd>
            <dd><a href="../../0.10.6/http/">0.10.6</a></dd>
            <dd><a href="../../0.9.2/http/">0.9.2</a></dd>
            <dd><a href="../../0.8.12/http/">0.8.12</a></dd>
            <dd><a href="../../0.7.4/http/">0.7.4</a></dd>
        </dl>
    </div>
</div>


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.8.12',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>